using System.Net;

namespace Tests.Integration.Tests;

[TestFixture]
[NonParallelizable]
[Order(TestOrder.Admin)]
public class Suite05AdminTests
{
    [Test]
    [Order(1)]
    public async Task Test01ClearCacheAsAdmin()
    {
        var token = await LoginHelper.GetAdminToken();
        var result = await TestClient.General.ClearCache(token);
        result.StatusCode.Should().Be(HttpStatusCode.OK);
    }

    [Test]
    [Order(2)]
    public async Task Test02ClearCacheAsManager()
    {
        var managerToken = await LoginHelper.GetManagerToken();
        var result = await TestClient.General.ClearCache(managerToken);
        
        // todo: Find out why forbid returns 404
        //result.StatusCode.Should().Be(HttpStatusCode.Forbidden));
        result.StatusCode.Should().Be(HttpStatusCode.NotFound);
    }

    [Test]
    [Order(3)]
    public async Task Test03SendTestEmailAsAdmin()
    {
        var token = await LoginHelper.GetAdminToken();
        var result = await TestClient.General.TestEmail(token);
        result.StatusCode.Should().Be(HttpStatusCode.OK);
    }

    [Test]
    [Order(4)]
    public async Task Test04SendTestEmailAsManager()
    {
        var managerToken = await LoginHelper.GetManagerToken();
        var result = await TestClient.General.TestEmail(managerToken);
        
        // todo: Find out why forbid returns 404
        //result.StatusCode.Should().Be(HttpStatusCode.Forbidden));
        result.StatusCode.Should().Be(HttpStatusCode.NotFound);
    }
}